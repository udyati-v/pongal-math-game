<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Pongal Math Harvest</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<style>
body{
  margin:0;
  font-family:Segoe UI,sans-serif;
  background:linear-gradient(#ffd54f,#ffb74d);
}
.sun{
  position:fixed;top:40px;right:40px;width:120px;height:120px;
  background:radial-gradient(circle,#fff176,#fbc02d);
  border-radius:50%;animation:pulse 4s infinite;z-index:-1;
}
@keyframes pulse{50%{transform:scale(1.1)}}
.kite{
  position:fixed;width:50px;height:50px;background:red;
  transform:rotate(45deg);animation:fly 12s linear infinite;z-index:-1;
}
@keyframes fly{from{left:-60px;top:70%}to{left:110%;top:10%}}
.card{
  max-width:650px;margin:60px auto;background:#fff8e1;
  padding:25px;border-radius:18px;
  box-shadow:0 12px 30px rgba(0,0,0,0.2);text-align:center;
}
input,button{padding:12px;font-size:16px;width:90%;margin-top:12px}
button{background:#43a047;color:#fff;border:none;border-radius:8px}
.hidden{display:none}
.gold{color:gold}.silver{color:silver}.bronze{color:#cd7f32}
</style>
</head>

<body>

<div class="sun"></div>
<div class="kite"></div>

<!-- START PAGE -->
<div class="card" id="startPage">
<h1>ğŸŒ¾ Pongal Math Harvest â˜€ï¸</h1>
<p><b>Beat the clock! â°ï¸ Solve more,â—ï¸ score moreğŸ’¯ â€” top 3 wins rewards!âœ¨ï¸</b></p>
<input id="playerName" placeholder="Enter your name">
<button onclick="startGame()">Start Game</button>
</div>

<!-- GAME PAGE -->
<div class="card hidden" id="gamePage">
<h2 id="qCounter"></h2>
<p id="introText"></p>
<p id="questionText"></p>
<input id="answerInput" placeholder="Type answer">
<button onclick="submitAnswer()">Submit</button>
<p>â± Time Left: <span id="time">60</span>s</p>
<p>â­ Score: <span id="score">0</span></p>
</div>

<!-- LEADERBOARD PAGE -->
<div class="card hidden" id="leaderboardPage">
<h2>ğŸ† Global Leaderboard (Top 10)</h2>
<ol id="leaderboardList"></ol>
</div>

<script>
firebase.initializeApp({
  apiKey:"AIzaSyBnFhuDbItM9kwjMgeDVrvMlWy5p-dNaLM",
  authDomain:"pongal-math-game.firebaseapp.com",
  projectId:"pongal-math-game"
});
const db=firebase.firestore();

let questions=[],i=0,score=0,time=60,timer,name="";

/* -------- UPDATED COMPULSORY QUESTIONS (Q1â€“Q7) -------- */
const compulsory=[
{q:`Question 1
What does July â€“ June signify:
a) Crop year
b) Financial year
c) Academic year`,a:["a","crop year"]},

{q:`Question 2
Pi hide & seek! Spot the pi in the invite
a) Temple
b) Stove
c) Sugarcane`,a:["b","stove"]},

{q:`Question 3
Spot the handsome duo in this flyer?
(Hint: One cracked equations in dreams, the other is the Father of Indian Mathematics!)
a) Harish Chandra and Bhaskaracharya
b) P.C. Mahalanobis and Satyendra Nath Bose
c) Srinivasa Ramanujan and Aryabhata`,a:["c","ramanujan","aryabhata"]},

{q:`Question 4
What does Sankranti signify astronomically?
a) Full moon day
b) Sunâ€™s transition into Capricorn (Makara Rashi)
c) Start of winter
d) Spring equinox`,a:["b"]},

{q:`Question 5
Why are kites flown during Sankranti?
a) For entertainment only
b) To scare birds away
c) To mark the monsoon season
d) To welcome the Sunâ€™s northward journey (Uttarayan)`,a:["d","uttarayan"]},

{q:`Question 6
Stove ain't apple pieğŸ˜‚, itâ€™s Ï€â€¦ why?
a) Natureâ€™s infinite harvest loop in lifeâ€™s eternal abundance circle
b) Because Ï€ represents the number of cashews used in making pongal`,a:["a"]},

{q:`Question 7
Total Harvest = 750 kg
Rice constitutes 40% of the total harvest.
How many kilograms of rice were harvested?
a) 300 kg
b) 250 kg
c) 350 kg`,a:["a","300","300 kg"]}
];

/* -------- POOL QUESTIONS (UNCHANGED) -------- */
const pool=[
{q:`If f(x)=2xÂ²âˆ’3, find f(4).`,a:["29"]},
{q:`Evaluate: logâ‚â‚€(1000) âˆ’ logâ‚â‚€(10).`,a:["2"]},
{q:`Divide â‚¹1800 in the ratio 2:3. Find the larger share.`,a:["1080"]},
{q:`If y=xÂ² is translated 3 units right, write the new function.`,a:["(x-3)^2"]},
{q:`During Pongal, 5 kg rice feeds 8 people. How many people will 20 kg feed?`,a:["32"]},
{q:`If f(x)=xÂ²+2x, find f(âˆ’3).`,a:["3"]},
{q:`Simplify: logâ‚â‚€(50)+logâ‚â‚€(2).`,a:["2"]},
{q:`A field yields rice:pulses in ratio 7:1. Find % of pulses.`,a:["12.5","12.5%"]},
{q:`If y=3xÂ², state the vertical stretch factor.`,a:["3"]},
{q:`A farmer increases yield from 200kg to 260kg. Find % increase.`,a:["30","30%"]},
{q:`If f(x)=xâˆ’4, find fâ»Â¹(x).`,a:["x+4"]},
{q:`Evaluate logâ‚â‚€(1).`,a:["0"]},
{q:`Divide 360kg in ratio 5:7. Find the smaller part.`,a:["150"]},
{q:`Translate y=xÂ² up by 5 units.`,a:["x^2+5"]},
{q:`A Pongal pot holds 4L milk. How many such pots for 18L?`,a:["5"]},
{q:`If f(x)=3xâˆ’1, find f(5).`,a:["14"]},
{q:`Evaluate logâ‚â‚€(100)+logâ‚â‚€(1000).`,a:["5"]},
{q:`Rice:Sugarcane = 4:9, total = 260kg. Find sugarcane.`,a:["180"]},
{q:`Reflect y=xÂ² in x-axis.`,a:["-x^2"]},
{q:`A farmer doubles rice yield from 120kg. New yield?`,a:["240"]}
];

questions = compulsory.concat(pool);

/* -------- GAME LOGIC -------- */
function startGame(){
  if(localStorage.getItem("played")) return alert("Only one attempt allowed");
  name=document.getElementById("playerName").value.trim();
  if(!name) return;
  document.getElementById("startPage").classList.add("hidden");
  document.getElementById("gamePage").classList.remove("hidden");
  startTimer();loadQ();
}

function startTimer(){
  timer=setInterval(()=>{
    time--;
    document.getElementById("time").innerText=time;
    if(time<=0)endGame();
  },1000);
}

function loadQ(){
  if(i>=questions.length)return endGame();

  document.getElementById("qCounter").innerText =
    `Question ${i+1} of ${questions.length}`;

  // ğŸ”” Special intro ONLY for first question
  document.getElementById("introText").innerText =
    i===0 ? "Start sweet: Brownie questions for Sihi huggi bonus points!" : "";

  document.getElementById("questionText").innerText=questions[i].q;
  document.getElementById("answerInput").value="";
}

function submitAnswer(){
  let a=document.getElementById("answerInput").value.toLowerCase();
  if(questions[i].a.some(x=>a.includes(x)))score+=5;
  document.getElementById("score").innerText=score;
  i++;loadQ();
}

function endGame(){
  clearInterval(timer);
  localStorage.setItem("played","yes");
  document.getElementById("gamePage").classList.add("hidden");
  document.getElementById("leaderboardPage").classList.remove("hidden");
  db.collection("scores").add({
    name,score,
    time:firebase.firestore.FieldValue.serverTimestamp()
  });
  db.collection("scores")
    .orderBy("score","desc").limit(10)
    .onSnapshot(s=>{
      let l=document.getElementById("leaderboardList");
      l.innerHTML="";
      s.forEach((d,i)=>{
        let medal=i==0?"ğŸ¥‡":i==1?"ğŸ¥ˆ":i==2?"ğŸ¥‰":"";
        let cls=i==0?"gold":i==1?"silver":i==2?"bronze":"";
        l.innerHTML+=
          `<li class="${cls}">${medal} ${d.data().name} â€” ${d.data().score}</li>`;
      });
    });
}
</script>

</body>
</html>
