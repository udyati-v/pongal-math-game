<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Pongal Math Harvest</title>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<style>
body {
  margin: 0;
  font-family: "Poppins", sans-serif;
  background: linear-gradient(-45deg,#f6c453,#f2a65a,#f7d046,#ffd27d);
  background-size: 400% 400%;
  animation: pongalBG 12s ease infinite;
}

@keyframes pongalBG {
  0% {background-position:0% 50%;}
  50% {background-position:100% 50%;}
  100% {background-position:0% 50%;}
}

.card {
  max-width: 520px;
  margin: 40px auto;
  background: #fff8e6;
  border-radius: 18px;
  padding: 24px;
  box-shadow: 0 10px 25px rgba(0,0,0,0.15);
}

h1 { text-align:center; }

input, button {
  width: 100%;
  padding: 12px;
  margin-top: 12px;
  font-size: 16px;
  border-radius: 8px;
}

button {
  background: #2ecc71;
  border: none;
  color: white;
  font-weight: bold;
}

button.skip {
  background:#f39c12;
}

.hidden { display:none; }

#timer { font-weight:bold; margin-top:10px; }
#score { margin-top:6px; }

.leaderboard-item {
  display:flex;
  justify-content:space-between;
  padding:6px 0;
}
</style>
</head>

<body>

<div class="card" id="startScreen">
  <h1>üåæ Pongal Math Harvest ‚òÄÔ∏è</h1>
  <p style="text-align:center;">
    Beat the clock! ‚è∞Ô∏è Solve more,‚ûóÔ∏è score moreüíØ ‚Äî top 3 wins rewards!‚ú®Ô∏è
  </p>
  <input id="playerName" placeholder="Enter your name"/>
  <button onclick="startGame()">Start Game</button>
</div>

<div class="card hidden" id="gameScreen">
  <div id="introText"></div>
  <h3 id="qNumber"></h3>
  <p id="questionText"></p>
  <input id="answerInput" placeholder="Type your answer"/>
  <button onclick="submitAnswer()">Submit</button>
  <button id="skipBtn" class="skip hidden" onclick="skipQuestion()">Skip</button>
  <div id="timer">‚è± Time Left: 2:30</div>
  <div id="score">‚≠ê Score: 0</div>
</div>

<div class="card hidden" id="leaderboardScreen">
  <h2>üèÜ Leaderboard (Top 10)</h2>
  <div id="leaderboardList"></div>
</div>

<script>
/* ---------------- FIREBASE ---------------- */
const firebaseConfig = {
  apiKey: "AIzaSyBnFhuDbItM9kwjMgeDVrvMlWy5p-dNaLM",
  authDomain: "pongal-math-game.firebaseapp.com",
  projectId: "pongal-math-game",
  storageBucket: "pongal-math-game.firebasestorage.app",
  messagingSenderId: "656858683321",
  appId: "1:656858683321:web:dc3f28c9c92e3394778868"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

/* ---------------- GAME STATE ---------------- */
let questions = [];
let index = 0;
let score = 0;
let timeLeft = 150;
let timer;

/* ---------------- COMPULSORY QUESTIONS ---------------- */
const compulsory = [
{
q:`Start sweet: Brownie questions for Sihi huggi bonus points!\n\nQuestion 1  
What does July ‚Äì June signify?  
a) Crop year  
b) Financial year  
c) Academic year`,
a:["a","crop year"]
},
{
q:`Question 2  
Pi hide & seek! Spot the pi in the invite  
a) Temple  
b) Stove  
c) Sugarcane`,
a:["b","stove"]
},
{
q:`Question 3  
Spot the handsome duo in this flyer?  
(Hint: One cracked equations in dreams, the other is the Father of Indian Mathematics!)  
a) Harish Chandra and Bhaskaracharya  
b) P.C. Mahalanobis and Satyendra Nath Bose  
c) Srinivasa Ramanujan and Aryabhata`,
a:["c","ramanujan","aryabhata"]
},
{
q:`Question 4  
What does Sankranti signify astronomically?  
a) Full moon day  
b) Sun‚Äôs transition into Capricorn (Makara Rashi)  
c) Start of winter  
d) Spring equinox`,
a:["b","capricorn","makara"]
},
{
q:`Question 5  
Why are kites flown during Sankranti?  
a) For entertainment only  
b) To scare birds away  
c) To mark the monsoon season  
d) To welcome the Sun‚Äôs northward journey (Uttarayan)`,
a:["d","uttarayan"]
},
{
q:`Question 6  
Stove ain't apple pieüòÇ, it‚Äôs œÄ‚Ä¶ why?  
a) Nature‚Äôs infinite harvest loop in life‚Äôs eternal abundance circle  
b) Because œÄ represents the number of cashews used in making pongal`,
a:["a"]
},
{
q:`Question 7  
Total Harvest = 750 kg  
Rice constitutes 40% of the total harvest.  
How many kilograms of rice were harvested?  
a) 300 kg  
b) 250 kg  
c) 350 kg`,
a:["a","300"]
}
];

/* ---------------- HARD QUESTION POOL (35) ---------------- */
const pool = [];
for(let i=1;i<=35;i++){
  pool.push({
    q:`Hard Question ${i}  
If f(x)=2x¬≤‚àí3x+5, find f(${i%5+2})`,
    a:[String(2*(i%5+2)**2 -3*(i%5+2)+5)]
  });
}

/* ---------------- GAME LOGIC ---------------- */
function startGame(){
  if(localStorage.getItem("played")){
    alert("Only one attempt allowed!");
    return;
  }
  const name = document.getElementById("playerName").value.trim();
  if(!name) return alert("Enter name");
  localStorage.setItem("played","yes");
  window.playerName=name;

  questions=[...compulsory,...shuffle(pool)];
  document.getElementById("startScreen").classList.add("hidden");
  document.getElementById("gameScreen").classList.remove("hidden");
  startTimer();
  loadQuestion();
}

function loadQuestion(){
  if(index>=questions.length){
    endGame();
    return;
  }
  document.getElementById("answerInput").value="";
  document.getElementById("qNumber").innerText=`Question ${index+1}`;
  document.getElementById("questionText").innerText=questions[index].q;
  document.getElementById("skipBtn").classList.toggle("hidden",index<7);
}

function submitAnswer(){
  const ans=document.getElementById("answerInput").value.toLowerCase();
  if(questions[index].a.some(x=>ans.includes(x))){
    score+=5;
  }
  index++;
  updateUI();
  loadQuestion();
}

function skipQuestion(){
  index++;
  loadQuestion();
}

function updateUI(){
  document.getElementById("score").innerText=`‚≠ê Score: ${score}`;
}

function startTimer(){
  timer=setInterval(()=>{
    timeLeft--;
    document.getElementById("timer").innerText=`‚è± Time Left: ${Math.floor(timeLeft/60)}:${(timeLeft%60).toString().padStart(2,"0")}`;
    if(timeLeft<=0) endGame();
  },1000);
}

function endGame(){
  clearInterval(timer);
  db.collection("scores").add({
    name:playerName,
    score,
    time:Date.now()
  }).then(showLeaderboard);
}

function showLeaderboard(){
  document.getElementById("gameScreen").classList.add("hidden");
  document.getElementById("leaderboardScreen").classList.remove("hidden");
  db.collection("scores").orderBy("score","desc").limit(10).get()
  .then(snap=>{
    let html="";
    snap.docs.forEach((d,i)=>{
      const medal=i==0?"ü•á":i==1?"ü•à":i==2?"ü•â":"";
      html+=`<div class="leaderboard-item">${medal} ${d.data().name}<span>${d.data().score}</span></div>`;
    });
    document.getElementById("leaderboardList").innerHTML=html;
  });
}

function shuffle(arr){
  return arr.sort(()=>Math.random()-0.5);
}
</script>
</body>
</html>
