<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Pongal Math Game</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Firebase -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getFirestore, collection, addDoc, getDocs, query, orderBy, limit } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyBnFhuDbItM9kwjMgeDVrvMlWy5p-dNaLM",
  authDomain: "pongal-math-game.firebaseapp.com",
  projectId: "pongal-math-game",
  storageBucket: "pongal-math-game.firebasestorage.app",
  messagingSenderId: "656858683321",
  appId: "1:656858683321:web:dc3f28c9c92e3394778868"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

window.db = db;
window.addDoc = addDoc;
window.collection = collection;
window.getDocs = getDocs;
window.query = query;
window.orderBy = orderBy;
window.limit = limit;
</script>

<style>
body {
  margin: 0;
  font-family: "Segoe UI", sans-serif;
  background: linear-gradient(#7b1e00, #ffb347);
  overflow-x: hidden;
  color: white;
}

/* BACKGROUND ANIMATIONS */
.sun {
  position: fixed;
  top: 20px;
  right: 20px;
  width: 120px;
  height: 120px;
  background: radial-gradient(circle, #ffd700, #ff8c00);
  border-radius: 50%;
  opacity: 0.3;
}

.sugarcane {
  position: fixed;
  left: 10px;
  bottom: 0;
  width: 15px;
  height: 300px;
  background: green;
}

.pot {
  position: fixed;
  right: 30px;
  bottom: 20px;
  width: 80px;
  height: 60px;
  background: #8b0000;
  border-radius: 0 0 40px 40px;
}

.card {
  max-width: 420px;
  margin: 80px auto;
  background: rgba(0,0,0,0.5);
  padding: 20px;
  border-radius: 15px;
}

button {
  width: 100%;
  padding: 12px;
  margin-top: 10px;
  font-size: 16px;
  border: none;
  border-radius: 8px;
}

.green { background: #1db954; color: white; }
.orange { background: #e67e22; color: white; }

input {
  width: 100%;
  padding: 10px;
  font-size: 16px;
  border-radius: 6px;
  border: none;
}

.hidden { display: none; }

#questionText {
  text-align: left;
  line-height: 1.6;
}

.leaderboard-row {
  display: flex;
  justify-content: space-between;
  margin: 6px 0;
}
</style>
</head>

<body>

<div class="sun"></div>
<div class="sugarcane"></div>
<div class="pot"></div>

<!-- START PAGE -->
<div id="startPage" class="card">
  <h2>Pongal Math Harvest üåæ</h2>
  <p><b>Beat the Clock ‚è∞Ô∏è! Solve More ‚ûïÔ∏è score more ‚ú®Ô∏è, top 3 wins prizes üèÜ</b></p>
  <input id="nameInput" placeholder="Enter your name">
  <button id="startBtn" class="green" disabled>Start Game</button>
</div>

<!-- GAME PAGE -->
<div id="gamePage" class="card hidden">
  <h3 id="qNumber"></h3>
  <div id="questionText"></div>

  <input id="answerInput" placeholder="Type your answer">
  <button class="green" onclick="submitAnswer()">Submit</button>
  <button id="skipBtn" class="orange hidden" onclick="skipQuestion()">Skip</button>

  <p>‚è≥ Time: <span id="time">02:30</span></p>
  <p>‚≠ê Score: <span id="score">0</span></p>
</div>

<!-- LEADERBOARD PAGE -->
<div id="leaderboardPage" class="card hidden">
  <h2>üèÜ Leaderboard (Top 10)</h2>
  <div id="leaderboard"></div>
</div>

<script>
/* ===== GAME LOGIC ===== */

const compulsory = [
`Start sweet: Brownie questions for Sihi huggi bonus points!

What does July ‚Äì June signify:
a) Crop year
b) Financial year
c) Academic year`,

`Pi hide & seek! Spot the pi in the invite
a) Temple
b) Stove
c) Sugarcane`,

`Spot the handsome duo in this flyer?
(Hint: One cracked equations in dreams, the other is the Father of Indian Mathematics!)
a) Harish Chandra and Bhaskaracharya
b) P.C. Mahalanobis and Satyendra Nath Bose
c) Srinivasa Ramanujan and Aryabhata`,

`What does Sankranti signify astronomically?
a) Full moon day
b) Sun‚Äôs transition into Capricorn (Makara Rashi)
c) Start of winter
d) Spring equinox`,

`Why are kites flown during Sankranti?
a) For entertainment only
b) To scare birds away
c) To mark the monsoon season
d) To welcome the Sun‚Äôs northward journey (Uttarayan)`,

`Stove ain't apple pie üòÇ, it‚Äôs œÄ‚Ä¶ why?
a) Nature‚Äôs infinite harvest loop in life‚Äôs eternal abundance circle
b) Because œÄ represents the number of cashews used in making pongal`,

`Total Harvest = 750 kg
Rice constitutes 40% of the total harvest.
How many kilograms of rice were harvested?
a) 300 kg
b) 250 kg
c) 350 kg`
];

const answers = ["a","b","c","b","d","a","a"];

let index = 0;
let score = 0;
let timeLeft = 150;
let timer;
let playerName = "";

document.getElementById("nameInput").addEventListener("input", e=>{
  document.getElementById("startBtn").disabled = e.target.value.trim()==="";
});

document.getElementById("startBtn").onclick = ()=>{
  playerName = nameInput.value.trim();
  startPage.classList.add("hidden");
  gamePage.classList.remove("hidden");
  startTimer();
  loadQuestion();
};

function startTimer(){
  timer = setInterval(()=>{
    timeLeft--;
    let m = Math.floor(timeLeft/60);
    let s = timeLeft%60;
    time.textContent = `${m}:${s.toString().padStart(2,"0")}`;
    if(timeLeft<=0) endGame();
  },1000);
}

function loadQuestion(){
  qNumber.textContent = `Question ${index+1}`;
  questionText.innerHTML = compulsory[index].replace(/\n/g,"<br>");
  skipBtn.classList.toggle("hidden", index<6);
}

function submitAnswer(){
  let user = answerInput.value.trim().toLowerCase();
  if(user===answers[index]) score+=5;
  else score-=2;
  scoreSpan.textContent = score;
  next();
}

function skipQuestion(){ next(); }

function next(){
  answerInput.value="";
  index++;
  if(index>=compulsory.length) endGame();
  else loadQuestion();
}

async function endGame(){
  clearInterval(timer);
  await addDoc(collection(db,"scores"),{name:playerName,score});
  showLeaderboard();
}

async function showLeaderboard(){
  gamePage.classList.add("hidden");
  leaderboardPage.classList.remove("hidden");
  const q = query(collection(db,"scores"),orderBy("score","desc"),limit(10));
  const snap = await getDocs(q);
  leaderboard.innerHTML="";
  let i=1;
  snap.forEach(d=>{
    let medal = i==1?"ü•á":i==2?"ü•à":i==3?"ü•â":"";
    leaderboard.innerHTML+=`<div class="leaderboard-row">${medal} ${i}. ${d.data().name} <span>${d.data().score}</span></div>`;
    i++;
  });
}
</script>
</body>
</html>
