<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Pongal Math Game</title>

<style>
body{
  margin:0;
  font-family: "Segoe UI", sans-serif;
  background: linear-gradient(180deg,#ffb347,#ffcc33);
  overflow:hidden;
}

/* ===== BACKGROUND ANIMATIONS ===== */
.sun{
  position:fixed;
  top:40px;
  right:40px;
  width:120px;
  height:120px;
  background:#ffd700;
  border-radius:50%;
  animation: glow 4s infinite alternate;
}
@keyframes glow{
  from{box-shadow:0 0 20px #ffd700;}
  to{box-shadow:0 0 50px #ff9900;}
}

.sugarcane{
  position:fixed;
  left:10px;
  bottom:0;
  width:20px;
  height:200px;
  background:green;
  border-radius:10px;
}

.pongal{
  position:fixed;
  right:30px;
  bottom:20px;
  width:80px;
  height:60px;
  background:#8b4513;
  border-radius:0 0 40px 40px;
}
.pongal::before{
  content:"";
  position:absolute;
  top:-25px;
  left:0;
  width:80px;
  height:25px;
  background:#ccc;
  border-radius:40px;
}

/* ===== CARD ===== */
.card{
  max-width:500px;
  margin:80px auto;
  background:#fff3e0;
  padding:25px;
  border-radius:15px;
  box-shadow:0 10px 30px rgba(0,0,0,0.2);
  text-align:center;
}

input{
  width:100%;
  padding:12px;
  font-size:16px;
  border-radius:8px;
  border:1px solid #ccc;
}

button{
  width:100%;
  padding:12px;
  margin-top:10px;
  font-size:16px;
  border:none;
  border-radius:8px;
  cursor:pointer;
}

.submit{background:#2ecc71;color:white;}
.skip{background:#e67e22;color:white;}

.footer{
  margin-top:15px;
  font-weight:bold;
}
</style>
</head>

<body>

<div class="sun"></div>
<div class="sugarcane"></div>
<div class="pongal"></div>

<!-- ================= GAME SCREEN ================= -->
<div id="gameScreen" class="card">
  <h2 id="qCount"></h2>
  <p id="questionText"></p>

  <input id="answer" placeholder="Type your answer">
  <button class="submit" onclick="submitAnswer()">Submit</button>
  <button id="skipBtn" class="skip" onclick="skipQuestion()" style="display:none">Skip</button>

  <div class="footer">
    ‚è≥ Time: <span id="time"></span><br>
    ‚≠ê Score: <span id="score">0</span>
  </div>
</div>

<!-- ================= LEADERBOARD SCREEN ================= -->
<div id="leaderboardScreen" class="card" style="display:none">
  <h2>üèÜ Leaderboard</h2>
  <p>Top 10 Pongal Math Champions</p>
  <ol id="leaderboardList"></ol>
</div>

<!-- ================= FIREBASE ================= -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getFirestore, collection, addDoc, getDocs, query, orderBy, limit } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyBnFhuDbItM9kwjMgeDVrvMlWy5p-dNaLM",
  authDomain: "pongal-math-game.firebaseapp.com",
  projectId: "pongal-math-game",
  storageBucket: "pongal-math-game.firebasestorage.app",
  messagingSenderId: "656858683321",
  appId: "1:656858683321:web:dc3f28c9c92e3394778868"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

/* ===== ATTEMPT LOGIC ===== */
if(localStorage.getItem("completed")==="yes"){
  document.getElementById("gameScreen").innerHTML="<h2>Game already completed</h2>";
}

/* ===== QUESTIONS ===== */
const compulsory = [
{
text:"Start sweet: Brownie questions for Sihi huggi bonus points!\n\nWhat does July ‚Äì June signify:\na) Crop year\nb) Financial year\nc) Academic year",
answer:"a"
},
{
text:"Pi hide & seek! Spot the pi in the invite\na) Temple\nb) Stove\nc) Sugarcane",
answer:"b"
},
{
text:"Spot the handsome duo in this flyer?\na) Harish Chandra and Bhaskaracharya\nb) P.C. Mahalanobis and S.N. Bose\nc) Srinivasa Ramanujan and Aryabhata",
answer:"c"
},
{
text:"What does Sankranti signify astronomically?\na) Full moon day\nb) Sun‚Äôs transition into Capricorn (Makara Rashi)\nc) Start of winter\nd) Spring equinox",
answer:"b"
},
{
text:"Why are kites flown during Sankranti?\na) For entertainment only\nb) To scare birds away\nc) To mark monsoon\nd) To welcome Sun‚Äôs northward journey",
answer:"d"
},
{
text:"Stove ain't apple pie üòÇ, it‚Äôs œÄ‚Ä¶ why?\na) Nature‚Äôs infinite harvest loop\nb) Number of cashews",
answer:"a"
},
{
text:"Total Harvest = 750 kg, Rice = 40%. How much rice harvested?\na) 300 kg\nb) 250 kg\nc) 350 kg",
answer:"a"
}
];

const pool = [
{text:"If f(x)=2x¬≤‚àí3x+5, find f(4)",answer:"25"},
{text:"Solve log‚ÇÅ‚ÇÄ(1000)",answer:"3"},
{text:"If 3:5 = x:20, find x",answer:"12"},
{text:"Translate y=x¬≤ up by 3 units. New equation?",answer:"y=x^2+3"},
{text:"If sinŒ∏=1/2, Œ∏ in degrees?",answer:"30"},
{text:"Find slope of line through (2,3) and (6,11)",answer:"2"},
{text:"Evaluate log‚ÇÅ‚ÇÄ(0.01)",answer:"-2"},
{text:"If f(x)=x¬≤‚àí1, find f(‚àí3)",answer:"8"},
{text:"Ratio of 45 to 60 simplified?",answer:"3:4"},
{text:"If area of square =49, side length?",answer:"7"}
];

let questions=[...compulsory,...pool.sort(()=>Math.random()-0.5)];
let index=0;
let score=0;
let timeLeft=150;
let timer;

/* ===== GAME ===== */
function startTimer(){
timer=setInterval(()=>{
  timeLeft--;
  let m=Math.floor(timeLeft/60);
  let s=timeLeft%60;
  document.getElementById("time").innerText=`${m}:${s.toString().padStart(2,"0")}`;
  if(timeLeft<=0) endGame();
},1000);
}

function showQuestion(){
  document.getElementById("qCount").innerText=`Question ${index+1}`;
  document.getElementById("questionText").innerText=questions[index].text;
  document.getElementById("answer").value="";
  document.getElementById("skipBtn").style.display = index>=6 ? "block":"none";
}

window.submitAnswer=()=>{
  let user=document.getElementById("answer").value.trim().toLowerCase();
  if(user==="") return;
  if(user===questions[index].answer.toLowerCase()) score+=5;
  else score-=2;
  document.getElementById("score").innerText=score;
  index++;
  index<questions.length ? showQuestion() : endGame();
};

window.skipQuestion=()=>{
  index++;
  index<questions.length ? showQuestion() : endGame();
};

async function endGame(){
  clearInterval(timer);
  localStorage.setItem("completed","yes");

  await addDoc(collection(db,"scores"),{
    score:score,
    time:new Date()
  });

  document.getElementById("gameScreen").style.display="none";
  document.getElementById("leaderboardScreen").style.display="block";

  const q=query(collection(db,"scores"),orderBy("score","desc"),limit(10));
  const snap=await getDocs(q);
  let list=document.getElementById("leaderboardList");
  list.innerHTML="";
  let r=1;
  snap.forEach(d=>{
    let li=document.createElement("li");
    li.innerHTML=(r==1?"ü•á":r==2?"ü•à":r==3?"ü•â":r+".")+" Score: "+d.data().score;
    list.appendChild(li);
    r++;
  });
}

startTimer();
showQuestion();
</script>
</body>
</html>
