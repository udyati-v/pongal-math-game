<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Pongal Math Game</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Firebase -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getFirestore, collection, addDoc, query, orderBy, limit, getDocs } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyBnFhuDbItM9kwjMgeDVrvMlWy5p-dNaLM",
  authDomain: "pongal-math-game.firebaseapp.com",
  projectId: "pongal-math-game",
  storageBucket: "pongal-math-game.firebasestorage.app",
  messagingSenderId: "656858683321",
  appId: "1:656858683321:web:dc3f28c9c92e3394778868"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
window.db = db;
window.addDoc = addDoc;
window.collection = collection;
window.query = query;
window.orderBy = orderBy;
window.limit = limit;
window.getDocs = getDocs;
</script>

<style>
body{
  margin:0;
  font-family:Arial, sans-serif;
  background: linear-gradient(135deg,#f7c873,#f4a261);
  min-height:100vh;
}
.card{
  max-width:420px;
  margin:30px auto;
  background:#fff3e0;
  padding:20px;
  border-radius:14px;
  box-shadow:0 8px 20px rgba(0,0,0,0.2);
}
h2,h3{text-align:center}
.question{
  white-space:pre-line;
  line-height:1.5;
}
input,button{
  width:100%;
  padding:12px;
  margin-top:10px;
  border-radius:8px;
  border:1px solid #ccc;
  font-size:16px;
}
button{border:none;cursor:pointer}
#submitBtn{background:#2ecc71;color:white}
#skipBtn{background:#e67e22;color:white}
.small{text-align:center;margin-top:10px}
.hidden{display:none}
</style>
</head>

<body>

<div class="card" id="startPage">
<h2>üåæ Pongal Math Challenge üåæ</h2>
<p style="text-align:center">
Beat the clock! ‚è∞Ô∏è Solve more,‚ûóÔ∏è score moreüíØ ‚Äî top 3 wins rewards!‚ú®Ô∏è
</p>
<input id="nameInput" placeholder="Enter your name">
<button onclick="startGame()">Start Game</button>
</div>

<div class="card hidden" id="gamePage">
<h3 id="qCounter"></h3>
<p id="extraText" style="font-weight:bold;"></p>
<p id="questionText" class="question"></p>
<input id="answerInput" placeholder="Type your answer">
<button id="submitBtn">Submit</button>
<button id="skipBtn" class="hidden">Skip</button>
<p class="small">‚è≥ Time Left: <span id="time"></span>s</p>
<p class="small">‚≠ê Score: <span id="score"></span></p>
</div>

<div class="card hidden" id="leaderboardPage">
<h2>üèÜ Leaderboard</h2>
<ol id="leaderboardList"></ol>
</div>

<script>
let score=0,time=150,index=0;
let playerName="";
let allQuestions=[];
let timer;

if(localStorage.getItem("pongal_attempted")){
  document.body.innerHTML="<h2 style='text-align:center'>You have already attempted the game.</h2>";
}

const compulsory=[
{
q:
`Question 1

What does July ‚Äì June signify?

a) Crop year  
b) Financial year  
c) Academic year`,
a:"a",
extra:"Start sweet: Brownie questions for Sihi huggi bonus points!"
},
{
q:
`Question 2

Pi hide & seek! Spot the pi in the invite

a) Temple  
b) Stove  
c) Sugarcane`,
a:"b"
},
{
q:
`Question 3

Spot the handsome duo in this flyer?
(Hint: One cracked equations in dreams, the other is the Father of Indian Mathematics!)

a) Harish Chandra and Bhaskaracharya  
b) P.C. Mahalanobis and Satyendra Nath Bose  
c) Srinivasa Ramanujan and Aryabhata`,
a:"c"
},
{
q:
`Question 4

What does Sankranti signify astronomically?

a) Full moon day  
b) Sun‚Äôs transition into Capricorn (Makara Rashi)  
c) Start of winter  
d) Spring equinox`,
a:"b"
},
{
q:
`Question 5

Why are kites flown during Sankranti?

a) For entertainment only  
b) To scare birds away  
c) To mark the monsoon season  
d) To welcome the Sun‚Äôs northward journey (Uttarayan)`,
a:"d"
},
{
q:
`Question 6

Stove ain't apple pie üòÇ, it‚Äôs œÄ‚Ä¶ why?

a) Nature‚Äôs infinite harvest loop in life‚Äôs eternal abundance circle  
b) Because œÄ represents the number of cashews used in making pongal`,
a:"a"
},
{
q:
`Question 7

Total Harvest = 750 kg  
Rice constitutes 40% of the total harvest.

How many kilograms of rice were harvested?

a) 300 kg  
b) 250 kg  
c) 350 kg`,
a:"a"
}
];

const pool=[];
for(let i=1;i<=35;i++){
  pool.push({
    q:
`Question ${i+7}

If f(x) = 2x¬≤ ‚àí 3x + 5, find f(${(i%5)+2})`,
    a:(2*((i%5)+2)**2 - 3*((i%5)+2) + 5).toString()
  });
}

allQuestions=[...compulsory,...pool.sort(()=>Math.random()-0.5)];

function startGame(){
  playerName=document.getElementById("nameInput").value.trim();
  if(!playerName)return alert("Enter name");
  document.getElementById("startPage").classList.add("hidden");
  document.getElementById("gamePage").classList.remove("hidden");
  document.getElementById("score").innerText=score;
  document.getElementById("time").innerText=time;
  loadQuestion();
  timer=setInterval(()=>{
    time--;
    document.getElementById("time").innerText=time;
    if(time<=0)endGame();
  },1000);
}

function loadQuestion(){
  if(index>=allQuestions.length)return endGame();
  let q=allQuestions[index];
  document.getElementById("qCounter").innerText=`Question ${index+1}`;
  document.getElementById("questionText").innerText=q.q;
  document.getElementById("extraText").innerText=q.extra||"";
  document.getElementById("answerInput").value="";
  document.getElementById("skipBtn").classList.toggle("hidden",index<6);
}

document.getElementById("submitBtn").onclick=()=>{
  let ans=document.getElementById("answerInput").value.trim().toLowerCase();
  if(ans===allQuestions[index].a)score+=5;
  document.getElementById("score").innerText=score;
  index++;
  loadQuestion();
};

document.getElementById("skipBtn").onclick=()=>{
  index++;
  loadQuestion();
};

async function endGame(){
  clearInterval(timer);
  localStorage.setItem("pongal_attempted","yes");
  document.getElementById("gamePage").classList.add("hidden");
  document.getElementById("leaderboardPage").classList.remove("hidden");

  await addDoc(collection(db,"scores"),{
    name:playerName,
    score:score,
    time:Date.now()
  });

  const q=query(collection(db,"scores"),orderBy("score","desc"),limit(10));
  const snap=await getDocs(q);
  let i=1;
  snap.forEach(d=>{
    let medal=i==1?"ü•á":i==2?"ü•à":i==3?"ü•â":"";
    leaderboardList.innerHTML+=`<li>${medal} ${d.data().name} ‚Äî ${d.data().score}</li>`;
    i++;
  });
}
</script>

</body>
</html>
