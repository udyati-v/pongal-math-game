<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Pongal Math Harvest üåæ</title>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

  <style>
    body{
      margin:0;
      font-family:"Segoe UI",sans-serif;
      background:linear-gradient(135deg,#ffd56b,#ffb347);
      display:flex;
      justify-content:center;
      align-items:center;
      min-height:100vh;
    }
    .card{
      background:#fff3dc;
      width:90%;
      max-width:520px;
      padding:25px;
      border-radius:18px;
      box-shadow:0 10px 25px rgba(0,0,0,.2);
      text-align:center;
    }
    h1{color:#7a3e00;}
    pre{white-space:pre-wrap;text-align:left;}
    input{
      width:100%;
      padding:12px;
      font-size:16px;
      border-radius:8px;
      border:1px solid #ccc;
      margin-top:10px;
    }
    button{
      width:100%;
      padding:12px;
      margin-top:12px;
      font-size:16px;
      border:none;
      border-radius:8px;
      cursor:pointer;
    }
    .submit{background:#2ecc71;color:white;}
    .skip{background:#e67e22;color:white;}
    .meta{margin-top:12px;font-weight:bold;}
  </style>
</head>

<body>
<div class="card" id="game">
  <h1>üåæ Pongal Math Harvest üåû</h1>
  <p><b>Beat the clock! ‚è∞ Solve more, ‚ûó score more üíØ ‚Äî top 3 wins rewards! ‚ú®</b></p>
  <button onclick="startGame()">Start Game</button>
</div>

<script>
/* ---------------- FIREBASE ---------------- */
const firebaseConfig = {
  apiKey: "AIzaSyBnFhuDbItM9kwjMgeDVrvMlWy5p-dNaLM",
  authDomain: "pongal-math-game.firebaseapp.com",
  projectId: "pongal-math-game",
  storageBucket: "pongal-math-game.firebasestorage.app",
  messagingSenderId: "656858683321",
  appId: "1:656858683321:web:dc3f28c9c92e3394778868"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

/* ---------------- TIME FORMAT ---------------- */
function formatTime(t){
  const m=Math.floor(t/60);
  const s=t%60;
  return `${m}:${s<10?"0"+s:s}`;
}

/* ---------------- QUESTIONS ---------------- */

/* COMPULSORY (UNCHANGED) */
const compulsory = [
{
 text:`Start sweet: Brownie questions for Sihi huggi bonus points!

Question 1  
What does July ‚Äì June signify:  
a) Crop year  
b) Financial year  
c) Academic year`,
 answers:["a","crop"]
},
{
 text:`Question 2  
Pi hide & seek! Spot the pi in the invite  
a) Temple  
b) Stove  
c) Sugarcane`,
 answers:["b","stove"]
},
{
 text:`Question 3  
Spot the handsome duo in this flyer?  
(Hint: One cracked equations in dreams, the other is the Father of Indian Mathematics!)  
a) Harish Chandra and Bhaskaracharya  
b) P.C. Mahalanobis and Satyendra Nath Bose  
c) Srinivasa Ramanujan and Aryabhata`,
 answers:["c","ramanujan","aryabhata"]
},
{
 text:`Question 4  
What does Sankranti signify astronomically?  
a) Full moon day  
b) Sun‚Äôs transition into Capricorn (Makara Rashi)  
c) Start of winter  
d) Spring equinox`,
 answers:["b","capricorn","makara"]
},
{
 text:`Question 5  
Why are kites flown during Sankranti?  
a) For entertainment only  
b) To scare birds away  
c) To mark the monsoon season  
d) To welcome the Sun‚Äôs northward journey (Uttarayan)`,
 answers:["d","uttarayan"]
},
{
 text:`Question 6  
Stove ain't apple pie üòÇ, it‚Äôs œÄ‚Ä¶ why?  
a) Nature‚Äôs infinite harvest loop in life‚Äôs eternal abundance circle  
b) Because œÄ represents the number of cashews used in making pongal`,
 answers:["a","infinite"]
},
{
 text:`Question 7  
Total Harvest = 750 kg  
Rice constitutes 40% of the total harvest.  
How many kilograms of rice were harvested?  
a) 300 kg  
b) 250 kg  
c) 350 kg`,
 answers:["a","300"]
}
];

/* HARD POOL (35 MIXED, NO REPEATS) */
const pool=[
{q:"Evaluate log‚ÇÅ‚ÇÄ(1000)",a:["3"]},
{q:"If f(x)=x¬≤‚àí4x+7, find f(3)",a:["4"]},
{q:"Solve 2x+5=17",a:["6"]},
{q:"Simplify sin¬≤30¬∞ + cos¬≤30¬∞",a:["1"]},
{q:"If 3:5 = x:25, find x",a:["15"]},
{q:"Translate y=x¬≤ right by 2 units ‚Üí value at x=0?",a:["4"]},
{q:"Solve log(100) ‚àí log(10)",a:["1"]},
{q:"Area of circle = 49œÄ, radius?",a:["7"]},
{q:"Solve 5x‚àí15=0",a:["3"]},
{q:"If f(x)=2x+3, find f‚Åª¬π(7)",a:["2"]},
{q:"Evaluate 2¬≥√ó2‚Å¥",a:["128"]},
{q:"Mean of 2,4,6,8",a:["5"]},
{q:"If x¬≤=49, positive x?",a:["7"]},
{q:"Solve log‚ÇÅ‚ÇÄx=2",a:["100"]},
{q:"Rice:pulses = 4:1, total 500kg. Rice?",a:["400"]},
{q:"Distance between (0,0) and (3,4)",a:["5"]},
{q:"Simplify ‚àö144",a:["12"]},
{q:"Solve x/5=9",a:["45"]},
{q:"If f(x)=x¬≤, find f(‚àí3)",a:["9"]},
{q:"Solve 7x=56",a:["8"]}
];

/* ---------------- GAME LOGIC ---------------- */
let name="",index=0,score=0,time=150,timer;
let questions=[];

function startGame(){
  name=prompt("Enter your name:");
  if(!name) return;
  questions=[...compulsory,...shuffle(pool)];
  showQuestion();
  timer=setInterval(()=>{
    time--;
    document.getElementById("time").innerText=formatTime(time);
    if(time<=0) endGame();
  },1000);
}

function showQuestion(){
  if(index>=questions.length) return endGame();
  const q=questions[index];
  document.getElementById("game").innerHTML=`
    <h2>Question ${index+1}</h2>
    <pre>${q.text||q.q}</pre>
    <input id="ans" placeholder="Type your answer">
    <button class="submit" onclick="submit()">Submit</button>
    ${index>=6?`<button class="skip" onclick="skip()">Skip</button>`:""}
    <div class="meta">‚è≥ Time Left: <span id="time">${formatTime(time)}</span></div>
    <div class="meta">‚≠ê Score: ${score}</div>
  `;
}

/* üî• SCORE LOGIC FIXED HERE üî• */
function submit(){
  const v=document.getElementById("ans").value.toLowerCase().trim();
  const correct=questions[index].answers||questions[index].a;

  if(correct.some(x=>v.includes(x))){
    score+=5;          // ‚úÖ correct
  }else{
    score-=2;          // ‚ùå wrong
    if(score<0) score=0;
  }

  index++;
  showQuestion();
}

function skip(){
  index++;
  showQuestion();
}

function endGame(){
  clearInterval(timer);
  db.collection("scores").add({name,score,time:Date.now()});
  document.getElementById("game").innerHTML=`
    <h2>Game Over üåæ</h2>
    <p><b>${name}</b>, your score: ‚≠ê ${score}</p>
    <p>Leaderboard updates automatically.</p>
  `;
}

function shuffle(arr){
  return arr.sort(()=>Math.random()-0.5);
}
</script>
</body>
</html>
